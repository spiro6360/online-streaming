<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>StreamX - Elite Live Streaming</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  </head>
  <body class="dark-theme">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <button class="icon-btn" id="btn-sidebar-toggle">
          <i data-lucide="menu"></i>
        </button>
        <a href="/" class="logo" id="lnk-home-logo">STREAM<span>X</span></a>
      </div>
      <div class="header-center">
        <div class="search-box">
          <i data-lucide="search" class="search-icon"></i>
          <input
            type="text"
            id="ipt-global-search"
            placeholder="채널, 방송 제목 검색"
          />
          <button id="btn-search-clear" class="hidden">
            <i data-lucide="x"></i>
          </button>
        </div>
      </div>
      <div class="header-right">
        <div id="zone-guest" class="auth-zone">
          <button class="ghost-btn" id="btn-login" onclick="window.app.toggleModal(true, 'login')">로그인</button>
          <button class="primary-btn" id="btn-register" onclick="window.app.toggleModal(true, 'register')">회원가입</button>
        </div>
        <div id="zone-user" class="auth-zone hidden">
          <button class="go-live-btn" id="btn-go-live" onclick="window.app.switchView('mypage')"><i data-lucide="video"></i> 방송하기</button>
          <span class="coin-badge">💰 <span id="user-cash">0</span></span>
          <div class="relative">
            <button class="icon-btn" id="btn-noti-toggle"><i data-lucide="bell"></i></button>
            <div id="popup-notifications" class="noti-dropdown hidden">
              <div class="noti-header">알림</div>
              <div class="noti-list">
                <div class="noti-empty">새로운 알림이 없습니다.</div>
              </div>
            </div>
          </div>
          <div class="user-avatar-circle" id="btn-my-avatar" onclick="window.app.switchView('mypage')">
            <img src="" id="header-avatar" />
          </div>
        </div>
      </div>
    </header>

    <div class="app-container">
      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar">
        <nav class="sidebar-nav">
          <button class="side-link active" data-view="home">
            <i data-lucide="home"></i> <span>홈</span>
          </button>
          <button class="side-link" data-view="live">
            <i data-lucide="radio"></i> <span>라이브</span>
          </button>
          <button class="side-link" data-view="vod">
            <i data-lucide="play-circle"></i> <span>VOD</span>
          </button>
          <button class="side-link" data-view="explore">
            <i data-lucide="compass"></i> <span>탐색</span>
          </button>
        </nav>
        <div class="sidebar-divider"></div>
        <div class="sidebar-section">
          <h3 class="side-title">추천 채널</h3>
          <div id="list-recommended" class="side-channel-list"></div>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content" id="scroll-main">
        <!-- Home View -->
        <section id="view-home" class="content-view">
          <div class="main-hero hidden" id="hero-banner">
            <div class="hero-overlay">
              <div class="hero-text">
                <span class="pill-live">추천 라이브</span>
                <h1 id="hero-title-text">방송 중인 라이브가 없습니다.</h1>
                <p id="hero-desc-text">새로운 방송을 시작해보세요.</p>
                <button class="primary-btn lg" id="btn-hero-watch">지금 입장하기</button>
              </div>
            </div>
          </div>
          <div class="section-top">
            <h2 id="home-title">인기 라이브 채널</h2>
          </div>
          <div class="stream-grid" id="grid-home"></div>
          <div id="empty-state" class="empty-placeholder hidden">
            <i data-lucide="search-x" class="empty-icon"></i>
            <h3>방송 결과가 없습니다</h3>
            <button class="primary-btn mt-4" onclick="window.app.toggleLiveModal(true)">방송 시작하기</button>
          </div>
        </section>

        <!-- Live View -->
        <section id="view-live" class="content-view hidden">
          <div class="page-head"><h1>실시간 라이브</h1></div>
          <div class="stream-grid" id="grid-live"></div>
        </section>

        <!-- VOD View -->
        <section id="view-vod" class="content-view hidden">
          <div class="page-head"><h1>다시보기 (VOD)</h1></div>
          <div class="stream-grid" id="grid-vod"></div>
        </section>

        <!-- My Page View -->
        <section id="view-mypage" class="content-view hidden">
          <div class="mypage-container">
            <div class="mypage-header">
              <div class="mp-profile">
                <img src="" id="mp-avatar" class="mp-avatar-img" />
                <div class="mp-info">
                  <h1 id="mp-username">사용자 이름</h1>
                  <p id="mp-email">user@example.com</p>
                </div>
              </div>
              <div class="mp-header-actions">
                <button class="ghost-btn" id="btn-logout">로그아웃</button>
                <button class="ghost-btn red" id="btn-withdraw">회원탈퇴</button>
              </div>
            </div>
            <div class="mypage-content">
              <div class="mp-card">
                <h3>방송 정보 설정</h3>
                <div class="stream-info-form">
                  <div class="field">
                    <label>방송 제목</label>
                    <input type="text" id="ipt-stream-title" placeholder="방송 제목을 입력하세요" />
                  </div>
                  <div class="field">
                    <label>카테고리</label>
                    <select id="sel-stream-category">
                      <option value="Just Chatting">Just Chatting</option>
                      <option value="Game">게임</option>
                      <option value="Music">음악</option>
                      <option value="Sports">스포츠</option>
                      <option value="Education">교육</option>
                    </select>
                  </div>
                  <button class="primary-btn w-full mt-2" id="btn-update-stream">방송 정보 업데이트</button>
                </div>
                <p class="help-text mt-2">방송 중에도 제목과 카테고리를 변경할 수 있습니다.</p>
              </div>
              <div class="mp-card">
                <h3>방송 송출 설정 (OBS용)</h3>
                <div class="stream-settings">
                  <div class="field">
                    <label>서버 URL (RTMP)</label>
                    <div class="copy-box">
                      <input type="text" value="rtmp://your-media-server-ip/live" readonly id="rtmp-url" />
                    </div>
                  </div>
                  <div class="field">
                    <label>스트림 키</label>
                    <div class="copy-box">
                      <input type="password" value="********" readonly id="stream-key-val" />
                      <button class="icon-btn" onclick="window.app.toggleStreamKey()"><i data-lucide="eye"></i></button>
                    </div>
                  </div>
                </div>
                <p class="help-text">OBS 설정 > 방송에서 위 정보를 입력하세요.</p>
              </div>
              <div class="mp-card">
                <h3>내 자산</h3>
                <div class="mp-cash">💰 <span id="mp-cash-val">0</span> 캐시</div>
              </div>
            </div>
          </div>
        </section>

        <!-- Player View -->
        <section id="view-player" class="content-view hidden">
          <div class="player-wrapper">
            <div class="player-main-area">
              <div class="video-box" id="video-frame">
                <video id="main-video" controls autoplay playsinline></video>
                <div id="toast-donation" class="donation-popup hidden"></div>
              </div>
              <div class="stream-profile-bar">
                <div class="sp-left">
                  <div class="sp-avatar"><img src="" id="p-img" /></div>
                  <div class="sp-info">
                    <h2 id="p-title">방송 제목</h2>
                    <div class="sp-meta"><span id="p-ch" class="bold-white">채널명</span></div>
                  </div>
                </div>
                <div class="sp-right">
                  <button class="star-btn" id="btn-p-donate">💰 캐시 후원</button>
                </div>
              </div>
            </div>
            <aside class="player-chat-area">
              <div class="chat-title">실시간 채팅</div>
              <div class="chat-list" id="chat-list"></div>
              <div class="chat-input-row">
                <input type="text" id="ipt-chat" placeholder="채팅에 참여하세요" />
                <button id="btn-chat-send"><i data-lucide="send"></i></button>
              </div>
            </aside>
          </div>
        </section>
      </main>
    </div>

    <!-- Mobile Nav -->
    <nav class="mobile-bottom-nav">
      <button class="m-nav-link active" data-view="home"><i data-lucide="home"></i><span>홈</span></button>
      <button class="m-nav-link" data-view="live"><i data-lucide="radio"></i><span>라이브</span></button>
      <button class="m-nav-link" id="btn-m-mypage" onclick="window.app.switchView('mypage')"><i data-lucide="user"></i><span>MY</span></button>
    </nav>

    <!-- Global Auth Modal -->
    <div class="modal-dim hidden" id="modal-global">
      <div class="modal-box">
        <button class="modal-x" id="btn-modal-close"><i data-lucide="x"></i></button>
        <div class="modal-inner">
          <h2 id="modal-title">로그인</h2>
          <div id="modal-fields">
            <!-- JS에서 동적으로 생성됨 -->
          </div>
          <button class="primary-btn w-full lg mt-4" id="btn-modal-submit">계속하기</button>
          <div class="modal-sub-actions">
            <span id="txt-modal-switch">계정이 없으신가요?</span>
            <button id="btn-modal-switch">회원가입</button>
          </div>
        </div>
      </div>
    </div>

    <script src="main.js"></script>
  </body>
</html>
